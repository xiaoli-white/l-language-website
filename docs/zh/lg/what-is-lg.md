# 什么是LG

## 概述

LG（L Generator）模块是 L 语言编译器工具链中的代码生成模块。它负责将中间表示（IR）转换为目标平台的代码，如字节码、机器码或其他中间表示。

LG 模块采用插件化架构，支持通过插件扩展以支持不同的目标平台，提供了良好的可扩展性和灵活性。

## 模块结构

LG 模块由以下几个主要包组成：

- `ldk.l.lg` - 核心生成器组件
- `ldk.l.lg.ir` - IR 访问和处理
- `ldk.l.lg.parser` - 解析器相关组件

## 核心组件

### LGenerator

[LGenerator](/lg/lgenerator) 是 LG 模块的主入口类，负责：

1. 解析命令行参数
2. 根据指定平台加载相应的代码生成插件
3. 调度代码生成过程

### Generator

[Generator](/lg/generator) 是代码生成器的抽象基类，定义了所有具体代码生成器必须实现的接口。

### IR 处理组件

LG 模块包含完整的 IR 处理能力：

1. [IRVisitor](/lg/ir-visitor) - IR 访问者模式实现
2. 各种 IR 节点的处理逻辑
3. IR 遍历和转换功能

## 设计模式

### 插件化架构

LG 模块使用插件化架构，通过 PackageManager 加载代码生成插件。这种设计允许：

1. **动态扩展** - 可以在运行时添加新的目标平台支持
2. **解耦合** - 核心模块与具体平台实现分离
3. **易于维护** - 每个平台的代码生成器可以独立开发和维护

### 访问者模式

LG 模块使用访问者模式遍历和处理 IR 节点，这种设计模式使得：

1. **易于添加新操作** - 可以在不修改 IR 节点类的情况下添加新的操作
2. **关注点分离** - 遍历逻辑与操作逻辑分离
3. **一致的接口** - 提供统一的 IR 节点处理接口

## 功能特性

### 多平台支持

LG 模块支持生成多种目标平台的代码：

1. **LVM 字节码** - 默认平台，生成 L 虚拟机可执行的字节码
2. **LLVM IR** - 通过插件支持生成 LLVM 中间表示
3. **其他平台** - 可通过插件扩展支持更多目标平台

### 命令行接口

LG 模块提供了友好的命令行接口，支持以下选项：

1. `--help`, `-h` - 显示帮助信息
2. `--version`, `-v` - 显示版本信息
3. `--verbose` - 启用详细输出
4. `--platform` - 指定目标平台
5. `--output`, `-o` - 指定输出文件

### 插件机制

LG 模块通过 PackageManager 管理代码生成插件：

1. **插件发现** - 自动发现和加载代码生成插件
2. **依赖管理** - 插件可以有自己的依赖库
3. **动态加载** - 运行时动态加载插件 JAR 文件

## 使用场景

### 命令行使用

LG 模块可以作为独立的命令行工具使用：

```bash
lg --platform lvm --output program.lvm program.ir
```

### API 调用

其他模块可以通过 API 调用 LG 模块的功能：

```java
LGenerator.generate(irModule, options);
```

### 插件开发

开发者可以开发新的代码生成插件来支持新的目标平台。

## 总结

LG 模块是 L 语言编译器工具链中的关键组件，提供了从 IR 到目标代码的转换功能。其插件化架构和访问者模式的使用使得模块具有良好的可扩展性和维护性，能够支持多种目标平台的代码生成。